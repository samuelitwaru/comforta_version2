ALTER TABLE Trn_Manager ADD ManagerIsActive BOOLEAN NOT NULL DEFAULT FALSE;
ALTER TABLE Trn_Manager ALTER COLUMN ManagerIsActive DROP DEFAULT;

ALTER TABLE Trn_Receptionist ADD ReceptionistIsActive BOOLEAN NOT NULL DEFAULT FALSE;
ALTER TABLE Trn_Receptionist ALTER COLUMN ReceptionistIsActive DROP DEFAULT;

CREATE TABLE Trn_CallToAction (CallToActionId CHAR(36) NOT NULL , ProductServiceId CHAR(36) NOT NULL , OrganisationId CHAR(36) NOT NULL , LocationId CHAR(36) NOT NULL , CallToActionName VARCHAR(100) NOT NULL , CallToActionType VARCHAR(100) NOT NULL , CallToActionPhone CHAR(20) NOT NULL , CallToActionUrl VARCHAR(1000) NOT NULL , CallToActionEmail VARCHAR(100) NOT NULL , LocationDynamicFormId CHAR(36) , PRIMARY KEY(CallToActionId));
CREATE INDEX ITRN_CALLTOACTION1 ON Trn_CallToAction (LocationDynamicFormId ,OrganisationId ,LocationId );
CREATE INDEX ITRN_CALLTOACTION2 ON Trn_CallToAction (ProductServiceId ,LocationId ,OrganisationId );
INSERT INTO Trn_CallToAction (CallToActionId, ProductServiceId, OrganisationId, LocationId, CallToActionName, CallToActionType, CallToActionPhone, CallToActionUrl, CallToActionEmail, LocationDynamicFormId) (SELECT DISTINCT CallToActionId, '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000', '00000000-0000-0000-0000-000000000000', '', '', '', '', '', Cast(NULL AS CHAR(36)) FROM Trn_ProductServiceCallToAction);

CREATE TABLE Trn_LocationDynamicForm (LocationDynamicFormId CHAR(36) NOT NULL , OrganisationId CHAR(36) NOT NULL , LocationId CHAR(36) NOT NULL , WWPFormId smallint NOT NULL , WWPFormVersionNumber smallint NOT NULL , PRIMARY KEY(LocationDynamicFormId, OrganisationId, LocationId));
CREATE INDEX ITRN_LOCATIONDYNAMICFORM1 ON Trn_LocationDynamicForm (WWPFormId ,WWPFormVersionNumber );
CREATE INDEX ITRN_LOCATIONDYNAMICFORM2 ON Trn_LocationDynamicForm (LocationId ,OrganisationId );

DROP TABLE Trn_ProductServiceCallToAction CASCADE;

ALTER TABLE Trn_LocationDynamicForm ADD CONSTRAINT ITRN_LOCATIONDYNAMICFORM2 FOREIGN KEY (LocationId, OrganisationId) REFERENCES Trn_Location (LocationId, OrganisationId);
ALTER TABLE Trn_LocationDynamicForm ADD CONSTRAINT ITRN_LOCATIONDYNAMICFORM1 FOREIGN KEY (WWPFormId, WWPFormVersionNumber) REFERENCES WWP_Form (WWPFormId, WWPFormVersionNumber);

ALTER TABLE Trn_CallToAction ADD CONSTRAINT ITRN_CALLTOACTION2 FOREIGN KEY (ProductServiceId, LocationId, OrganisationId) REFERENCES Trn_ProductService (ProductServiceId, LocationId, OrganisationId);
ALTER TABLE Trn_CallToAction ADD CONSTRAINT ITRN_CALLTOACTION1 FOREIGN KEY (LocationDynamicFormId, OrganisationId, LocationId) REFERENCES Trn_LocationDynamicForm (LocationDynamicFormId, OrganisationId, LocationId);

